__NUXT_JSONP__("/blog/raspotify-proxmox-lxc", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at){return {data:[{blog:{slug:"index",description:"Setting up and passing an audio device to Raspotify in a Proxmox Debian LXC.",title:"Raspotify + Proxmox LXC: Audio device passthrough",updatedAt:"2024-07-21T00:00:00.000Z",img:U,toc:[{id:V,depth:w,text:W},{id:X,depth:w,text:Y},{id:Z,depth:w,text:_},{id:$,depth:w,text:aa},{id:ab,depth:C,text:ac},{id:ad,depth:C,text:ae},{id:af,depth:w,text:ag},{id:ah,depth:C,text:ai},{id:aj,depth:C,text:ak}],body:{type:al,children:[{type:b,tag:am,props:{src:U,alt:"Cover image showing logos for Proxmox, Linux Containers, and Spotify"},children:[{type:a,value:e}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:m,props:{href:"https:\u002F\u002Fgithub.com\u002Fdtcooper\u002Fraspotify",rel:[x,y,z],target:A},children:[{type:a,value:"Raspotify"}]},{type:a,value:" is a popular open-source\n"},{type:b,tag:m,props:{href:"https:\u002F\u002Fconnect.spotify.com\u002F",rel:[x,y,z],target:A},children:[{type:a,value:"Spotify Connect"}]},{type:a,value:" client designed to \"just work\" on a Raspberry Pi.\n"},{type:b,tag:m,props:{href:"https:\u002F\u002Fwww.proxmox.com\u002Fen\u002F",rel:[x,y,z],target:A},children:[{type:a,value:"Proxmox"}]},{type:a,value:" is a popular open-source server virtualization solution that\nsimplifies container and virtual machine management. This post details how I run Raspotify inside a\nDebian LXC, using an audio device shared from the host machine. I assume a reasonable level of Linux\nand Proxmox knowledge."}]},{type:a,value:e},{type:b,tag:B,props:{id:V},children:[{type:b,tag:m,props:{href:"#creating-the-debian-lxc",ariaHidden:o,tabIndex:p},children:[{type:b,tag:c,props:{className:[q,r]},children:[]}]},{type:a,value:W}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"I use tteck's famous scripts to quickly set up Proxmox containers and services. This one sets up a Debian 12 LXC: "},{type:b,tag:m,props:{href:an,rel:[x,y,z],target:A},children:[{type:a,value:an}]},{type:a,value:". As always, exercise caution when executing scripts from the internet."}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Take note of the numeric ID of the given container, I'll refer to it as "},{type:b,tag:f,props:{},children:[{type:a,value:"\u003CCTID\u003E"}]},{type:a,value:s}]},{type:a,value:e},{type:b,tag:B,props:{id:X},children:[{type:b,tag:m,props:{href:"#finding-the-audio-devices",ariaHidden:o,tabIndex:p},children:[{type:b,tag:c,props:{className:[q,r]},children:[]}]},{type:a,value:Y}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"In Linux, "},{type:b,tag:f,props:{},children:[{type:a,value:"\u002Fdev\u002Fsnd"}]},{type:a,value:" is a directory that contains device files related to the sound subsystem of the operating system. These files are used to interface with the sound hardware of the computer. The three that we're interested in are:"}]},{type:a,value:e},{type:b,tag:D,props:{},children:[{type:a,value:e},{type:b,tag:j,props:{},children:[{type:b,tag:f,props:{},children:[{type:a,value:"pcmC0D0p"}]},{type:a,value:", a PCM playback device for the first sound card (Card 0, Device 0)."}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:b,tag:f,props:{},children:[{type:a,value:"controlC0"}]},{type:a,value:", used for controlling various mixer and sound card parameters for Card 0."}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:b,tag:f,props:{},children:[{type:a,value:"timer"}]},{type:a,value:", used for timing purposes in audio applications."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:E},{type:b,tag:f,props:{},children:[{type:a,value:ao}]},{type:a,value:" to check that these files exist; we'll need to give our LXC access to them."}]},{type:a,value:e},{type:b,tag:B,props:{id:Z},children:[{type:b,tag:m,props:{href:"#passing-through-the-audio-devices",ariaHidden:o,tabIndex:p},children:[{type:b,tag:c,props:{className:[q,r]},children:[]}]},{type:a,value:_}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Since PVE 8.1, we can pass through devices using the following syntax: "},{type:b,tag:f,props:{},children:[{type:a,value:"pct set \u003CCTID\u003E -dev\u003Cn\u003E \u002Fdev\u002Fpath\u002Fto\u002Ffile"}]},{type:a,value:s}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"In our case we need to pass through three devices."}]},{type:a,value:e},{type:b,tag:K,props:{className:[L]},children:[{type:b,tag:M,props:{className:[N,ap]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"pct "},{type:b,tag:c,props:{className:[d,O,P]},children:[{type:a,value:Q}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:R}]},{type:a,value:F},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:S}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,G,H]},children:[{type:a,value:"-dev1"}]},{type:a,value:" \u002Fdev\u002Fsnd\u002FpcmC0D0p\npct "},{type:b,tag:c,props:{className:[d,O,P]},children:[{type:a,value:Q}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:R}]},{type:a,value:F},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:S}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,G,H]},children:[{type:a,value:"-dev2"}]},{type:a,value:" \u002Fdev\u002Fsnd\u002FcontrolC0\npct "},{type:b,tag:c,props:{className:[d,O,P]},children:[{type:a,value:Q}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:R}]},{type:a,value:F},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:S}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,G,H]},children:[{type:a,value:"-dev3"}]},{type:a,value:aq}]}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Alternatively, you can edit the configuration file for the container, store in "},{type:b,tag:f,props:{},children:[{type:a,value:"\u002Fetc\u002Fpve\u002Flxc\u002F\u003CCTID\u003E.conf"}]},{type:a,value:". Mine looks like this:"}]},{type:a,value:e},{type:b,tag:K,props:{className:[L]},children:[{type:b,tag:M,props:{className:[N,"language-yaml"]},children:[{type:b,tag:f,props:{},children:[{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"arch"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:" amd64\n"},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"cores"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:T}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"dev1"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:" \u002Fdev\u002Fsnd\u002FcontrolC0\n"},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"dev2"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:" \u002Fdev\u002Fsnd\u002FpcmC0D0p\n"},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"dev3"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:" \u002Fdev\u002Fsnd\u002Fseq\n"},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"dev4"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:aq},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"features"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:" keyctl=1"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:v}]},{type:a,value:"nesting=1\n"},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"hostname"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:" raspotify\n"},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"memory"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"2048"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"net0"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:" name=eth0"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:v}]},{type:a,value:"bridge=vmbr0"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:v}]},{type:a,value:"hwaddr=AB"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:"12"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:"CD"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:"34"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:"EF"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"56"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:v}]},{type:a,value:"ip=dhcp"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:v}]},{type:a,value:"type=veth\n"},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"onboot"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:T}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"ostype"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:" debian\n"},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"rootfs"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:" local"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:I}]},{type:a,value:"lvm"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:"vm"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:I}]},{type:a,value:F},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:I}]},{type:a,value:"disk"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"0"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:v}]},{type:a,value:"size=2G\n"},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"swap"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"512"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"unprivileged"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:h}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:T}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Reboot the container to apply your changes."}]},{type:a,value:e},{type:b,tag:B,props:{id:$},children:[{type:b,tag:m,props:{href:"#setting-up-the-container",ariaHidden:o,tabIndex:p},children:[{type:b,tag:c,props:{className:[q,r]},children:[]}]},{type:a,value:aa}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Log in to the container."}]},{type:a,value:e},{type:b,tag:J,props:{id:ab},children:[{type:b,tag:m,props:{href:"#fixing-the-audio-devices",ariaHidden:o,tabIndex:p},children:[{type:b,tag:c,props:{className:[q,r]},children:[]}]},{type:a,value:ac}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"I found that the devices were owned by the "},{type:b,tag:f,props:{},children:[{type:a,value:al}]},{type:a,value:" group instead of the "},{type:b,tag:f,props:{},children:[{type:a,value:ar}]},{type:a,value:" group."}]},{type:a,value:e},{type:b,tag:D,props:{},children:[{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:"Check who owns the files with "},{type:b,tag:f,props:{},children:[{type:a,value:ao}]},{type:a,value:". If you see "},{type:b,tag:f,props:{},children:[{type:a,value:"root audio"}]},{type:a,value:" then that's great - skip the following steps. If you're like me and see "},{type:b,tag:f,props:{},children:[{type:a,value:"root root"}]},{type:a,value:", then continue."}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:E},{type:b,tag:f,props:{},children:[{type:a,value:"chown root:audio \u002Fdev\u002Fsnd\u002F*"}]},{type:a,value:" to fix the device permissions, these will be reset on every boot."}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:"Set up a crontab script to fix the permissions on boot.\n"},{type:b,tag:D,props:{},children:[{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:E},{type:b,tag:f,props:{},children:[{type:a,value:"crontab -e"}]},{type:a,value:", and press enter to confirm that we want to use the "},{type:b,tag:f,props:{},children:[{type:a,value:"nano"}]},{type:a,value:" text editor."}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:"Append the following to the bottom of the file: "},{type:b,tag:f,props:{},children:[{type:a,value:"@reboot chown root:audio \u002Fdev\u002Fsnd\u002F*"}]},{type:a,value:s}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:"Save your changes and exit by pressing "},{type:b,tag:f,props:{},children:[{type:a,value:"Ctrl"}]},{type:a,value:"+"},{type:b,tag:f,props:{},children:[{type:a,value:"X"}]},{type:a,value:", then "},{type:b,tag:f,props:{},children:[{type:a,value:"y"}]},{type:a,value:" to confirm."}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:J,props:{id:ad},children:[{type:b,tag:m,props:{href:"#install-raspotify",ariaHidden:o,tabIndex:p},children:[{type:b,tag:c,props:{className:[q,r]},children:[]}]},{type:a,value:ae}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Follow the "},{type:b,tag:m,props:{href:"https:\u002F\u002Fgithub.com\u002Fdtcooper\u002Fraspotify?tab=readme-ov-file#installation",rel:[x,y,z],target:A},children:[{type:a,value:"Raspotify instructions"}]},{type:a,value:" to install it."}]},{type:a,value:e},{type:b,tag:K,props:{className:[L]},children:[{type:b,tag:M,props:{className:[N,ap]},children:[{type:b,tag:f,props:{},children:[{type:b,tag:c,props:{className:[d,as]},children:[{type:a,value:"curl"}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,G,H]},children:[{type:a,value:"-sL"}]},{type:a,value:" https:\u002F\u002Fdtcooper.github.io\u002Fraspotify\u002Finstall.sh "},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"|"}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,as]},children:[{type:a,value:"sh"}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"By default, the user running Raspotify is not in the audio group."}]},{type:a,value:e},{type:b,tag:D,props:{},children:[{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:"Check who is running "},{type:b,tag:f,props:{},children:[{type:a,value:"librespot"}]},{type:a,value:" (the underlying Raspotify library) with: "},{type:b,tag:f,props:{},children:[{type:a,value:"ps -o uname -p $(pgrep librespot)"}]},{type:a,value:". In my case, the user is "},{type:b,tag:f,props:{},children:[{type:a,value:"raspotify"}]},{type:a,value:s}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:"Then add that user to the "},{type:b,tag:f,props:{},children:[{type:a,value:ar}]},{type:a,value:" group: "},{type:b,tag:f,props:{},children:[{type:a,value:"usermod -aG audio raspotify"}]},{type:a,value:s}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:"Optionally, edit the config file, "},{type:b,tag:f,props:{},children:[{type:a,value:at}]},{type:a,value:s}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:"Reload Raspotify: "},{type:b,tag:f,props:{},children:[{type:a,value:"service raspotify restart"}]},{type:a,value:s}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:"strong",props:{},children:[{type:a,value:"🎉 Woohoo, you made it! You should now be able to play music 🎉"}]}]},{type:a,value:e},{type:b,tag:B,props:{id:af},children:[{type:b,tag:m,props:{href:"#troubleshooting",ariaHidden:o,tabIndex:p},children:[{type:b,tag:c,props:{className:[q,r]},children:[]}]},{type:a,value:ag}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"If everything went to plan then you wouldn't be reading this. But it's never that easy, is it?"}]},{type:a,value:e},{type:b,tag:J,props:{id:ah},children:[{type:b,tag:m,props:{href:"#volume-too-low",ariaHidden:o,tabIndex:p},children:[{type:b,tag:c,props:{className:[q,r]},children:[]}]},{type:a,value:ai}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:E},{type:b,tag:f,props:{},children:[{type:a,value:"alsamixer"}]},{type:a,value:" and then use the arrow keys to adjust the system volume. The default volue is 50%."}]},{type:a,value:e},{type:b,tag:am,props:{src:"alsamixer.png",alt:"Screenshot of AlsaMixer"},children:[{type:a,value:"\n  Change the system volume using AlsaMixer. \n"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Still too low? Change the "},{type:b,tag:f,props:{},children:[{type:a,value:"LIBRESPOT_NORMALISATION_PREGAIN"}]},{type:a,value:" option in "},{type:b,tag:f,props:{},children:[{type:a,value:at}]},{type:a,value:" to a larger number."}]},{type:a,value:e},{type:b,tag:J,props:{id:aj},children:[{type:b,tag:m,props:{href:"#helpful-commands",ariaHidden:o,tabIndex:p},children:[{type:b,tag:c,props:{className:[q,r]},children:[]}]},{type:a,value:ak}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"A few bonus commands:"}]},{type:a,value:e},{type:b,tag:"ul",props:{},children:[{type:a,value:e},{type:b,tag:j,props:{},children:[{type:b,tag:f,props:{},children:[{type:a,value:"aplay -l"}]},{type:a,value:": lists all hardware devices handled by ALSA."}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:b,tag:f,props:{},children:[{type:a,value:"librespot --device ?"}]},{type:a,value:": lists devices with their supported format and sample rates."}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:b,tag:f,props:{},children:[{type:a,value:"speaker-test -twav -c6"}]},{type:a,value:": plays a not-deafening sound on the default ALSA device."}]},{type:a,value:e}]}]},dir:"\u002Fblog\u002Fraspotify-proxmox-lxc",path:"\u002Fblog\u002Fraspotify-proxmox-lxc\u002Findex",extension:".md",createdAt:"2024-07-22T12:00:29.448Z"}}],fetch:{},mutations:[]}}("text","element","span","token","\n","code","punctuation",":","p","li","key","atrule","a"," ","true",-1,"icon","icon-link",".","operator","number",",",2,"nofollow","noopener","noreferrer","_blank","h2",3,"ol","Run ","CTID","parameter","variable","-","h3","div","nuxt-content-highlight","pre","line-numbers","builtin","class-name","set","\u003C","\u003E","1","cover.png","creating-the-debian-lxc","Creating the Debian LXC","finding-the-audio-devices","Finding the audio devices","passing-through-the-audio-devices","Passing through the audio devices","setting-up-the-container","Setting up the container","fixing-the-audio-devices","Fixing the audio devices","install-raspotify","Install Raspotify","troubleshooting","Troubleshooting","volume-too-low","Volume too low?","helpful-commands","Helpful commands","root","blog-img","https:\u002F\u002Ftteck.github.io\u002FProxmox\u002F#debian-lxc","ls -l \u002Fdev\u002Fsnd","language-sh"," \u002Fdev\u002Fsnd\u002Ftimer\n","audio","function","\u002Fetc\u002Fraspotify\u002Fconf")));