__NUXT_JSONP__("/blog/discord-embed-spoofing", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D){return {data:[{blog:{slug:"index",description:"Vulnerability in Discord client URL parsing makes custom embed content appear to come from a legitimate domain",title:"Discord embed spoofing",updatedAt:"2020-03-01T11:00:01.000Z",toc:[],body:{type:"root",children:[{type:b,tag:p,props:{},children:[{type:b,tag:"strong",props:{},children:[{type:a,value:"TLDR:"}]},{type:a,value:" I found a vulnerability in the way the Discord clients parse URLs which makes my custom\nembed content appear to come from a legitimate domain. The message "},{type:b,tag:f,props:{},children:[{type:a,value:"https:\u002F\u002Fdiscord.gg%2ek.vu"}]},{type:a,value:" will\nshow an embed from "},{type:b,tag:f,props:{},children:[{type:a,value:t}]},{type:a,value:" but display as "},{type:b,tag:f,props:{},children:[{type:a,value:u}]}]},{type:a,value:e},{type:b,tag:v,props:{},children:[{type:a,value:e}]},{type:a,value:e},{type:b,tag:p,props:{},children:[{type:a,value:"Discord uses Node’s "},{type:b,tag:f,props:{},children:[{type:a,value:"url.parse()"}]},{type:a,value:" function to process URLs in messages. Node’s parser expects to\nreceive a URL which has already had its percent encoding decoded into special characters. Discord’s\nweb and desktop clients forget to do this and instead attempt to parse the raw user input."}]},{type:a,value:e},{type:b,tag:p,props:{},children:[{type:a,value:"A "},{type:b,tag:f,props:{},children:[{type:a,value:w}]},{type:a,value:" symbol is never allowed in a hostname ("},{type:b,tag:"a",props:{href:x},children:[{type:a,value:x}]},{type:a,value:")\nso the parser considers the hostname as the text before the "},{type:b,tag:f,props:{},children:[{type:a,value:w}]},{type:a,value:". This results in the server (which\ndecodes the "},{type:b,tag:f,props:{},children:[{type:a,value:y}]},{type:a,value:" to a "},{type:b,tag:f,props:{},children:[{type:a,value:z}]},{type:a,value:") and the client seeing different URLs."}]},{type:a,value:e},{type:b,tag:"div",props:{className:["nuxt-content-highlight"]},children:[{type:b,tag:"pre",props:{className:["language-js","line-numbers"]},children:[{type:b,tag:f,props:{},children:[{type:b,tag:c,props:{className:[d,"comment"]},children:[{type:a,value:"\u002F\u002F node parseUrl.js 'https:\u002F\u002Fdiscord.gg%2ek.vu'"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,"maybe-class-name"]},children:[{type:a,value:"Url"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:"{"}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"protocol"}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:"'https:'"}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:n}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"slashes"}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,"boolean"]},children:[{type:a,value:"true"}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:n}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"auth"}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,r,o,s]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:n}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"host"}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:A}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:n}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"port"}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,r,o,s]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:n}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"hostname"}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:A}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:n}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"hash"}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,r,o,s]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:n}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"search"}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,r,o,s]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:n}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"query"}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,r,o,s]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:n}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"pathname"}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:n}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"path"}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:n}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"href"}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:"'https:\u002F\u002Fdiscord.gg\u002F%2ek.vu'"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:"}"}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:p,props:{},children:[{type:a,value:"The server which loads the embed content acts the same way as a normal web browser and decodes the\n"},{type:b,tag:f,props:{},children:[{type:a,value:y}]},{type:a,value:" before loading the embed from "},{type:b,tag:f,props:{},children:[{type:a,value:t}]},{type:a,value:". The desktop and web clients\nincorrectly parse the URL and display it as "},{type:b,tag:f,props:{},children:[{type:a,value:u}]},{type:a,value:", suggesting that the URL\ncame from "},{type:b,tag:f,props:{},children:[{type:a,value:C}]},{type:a,value:z}]},{type:a,value:e},{type:b,tag:D,props:{src:"discord_1.png"},children:[{type:a,value:"\n  It’s from discord.gg, right?\n"}]},{type:a,value:e},{type:b,tag:p,props:{},children:[{type:a,value:"This vulnerability can be used for much more realistic phishing attacks as the blue text that the\nuser is clicking is different to the website that it links to. For example, clicking “Join the\nOfficial Fortnite Discord Server!” in the image below sends the victim to a cloned Discord login\npage. The user has just seen the "},{type:b,tag:f,props:{},children:[{type:a,value:C}]},{type:a,value:" URL so they are unlikely to be suspicious of the login\npage."}]},{type:a,value:e},{type:b,tag:D,props:{src:"discord_2.png"},children:[{type:a,value:"\n  Phishing potential: clicking on the link in the embed will take you to my domain\n"}]},{type:a,value:e},{type:b,tag:v,props:{},children:[{type:a,value:e}]},{type:a,value:e},{type:b,tag:p,props:{},children:[{type:a,value:"I contacted Discord security about this vulnerability and they claim that it is not a security\nvulnerability as “there is no guarantee the link in a message matches the link in the title.” As\nsuch, there is no patch available and all desktop and web clients are currently vulnerable. Mobile\ndevices do not display the deceiving slash."}]}]},dir:"\u002Fblog\u002Fdiscord-embed-spoofing",path:"\u002Fblog\u002Fdiscord-embed-spoofing\u002Findex",extension:".md",createdAt:"2022-11-06T07:28:40.994Z"}}],fetch:{},mutations:[]}}("text","element","span","token","\n","code"," ","punctuation","\n  ","literal-property","property","operator",":",",","null","p","string","keyword","nil","https:\u002F\u002Fdiscord.gg.k.vu","https:\u002F\u002Fdiscord.gg\u002F%2ek.vu","blog-hr","%","ietf.org\u002Frfc\u002Frfc2396.html#section-3.2.2","%2e",".","'discord.gg'","'%2ek.vu'","discord.gg","blog-img")));