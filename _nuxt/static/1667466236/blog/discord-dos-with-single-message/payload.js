__NUXT_JSONP__("/blog/discord-dos-with-single-message", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){return {data:[{blog:{slug:"index",description:"Crafted message causes causes denial of service on a Discord channel",title:"Discord DoS with a single message",updatedAt:"2020-02-13T11:00:01.000Z",toc:[],body:{type:"root",children:[{type:b,tag:f,props:{},children:[{type:b,tag:"strong",props:{},children:[{type:a,value:"TLDR:"}]},{type:a,value:" I discovered that sending the message "},{type:b,tag:g,props:{},children:[{type:a,value:q}]},{type:a,value:" from the mobile app would\nresult in a permanent denial of service of a Discord channel on the web and desktop clients."}]},{type:a,value:d},{type:b,tag:k,props:{},children:[{type:a,value:d}]},{type:a,value:d},{type:b,tag:f,props:{},children:[{type:a,value:"It began when my mentor, "},{type:b,tag:l,props:{href:r,rel:[m,n,o],target:p},children:[{type:a,value:s}]},{type:a,value:", sent me "},{type:b,tag:l,props:{href:"https:\u002F\u002Fwww.perimeterx.com\u002Ftech-blog\u002F2020\u002Fwhatsapp-fs-read-vuln-disclosure\u002F",rel:[m,n,o],target:p},children:[{type:a,value:"this blog post"}]},{type:a,value:"\nabout a WhatsApp vulnerability and encouraged me to look for similar bugs in other Electron-based\nchat clients. I started with Discord."}]},{type:a,value:d},{type:b,tag:f,props:{},children:[{type:a,value:"First I checked to see if the link’s preview text was being generated by my client or the server,\nin the hopes that I could edit the preview that was being displayed to other users. That wasn’t\nsuccessful, so I moved on to play with the "},{type:b,tag:g,props:{},children:[{type:a,value:t}]},{type:a,value:" symbol in my URLs."}]},{type:a,value:d},{type:b,tag:f,props:{},children:[{type:a,value:"URLs can provide a username and password for authentication in the following format\n"},{type:b,tag:g,props:{},children:[{type:a,value:"user:pass@website.com"}]},{type:a,value:". Discord’s mobile app completely stripped the authentication part of the\nURL, while the desktop and web clients left it in the link. This inconsistent handling of\nauthentication URLs immediately raised red flags, as it indicated that special code was used when an\n"},{type:b,tag:g,props:{},children:[{type:a,value:t}]},{type:a,value:" was present. With further testing, I discovered that the Discord server was not validating\npercent encoding correctly, and was accepting percent symbols even if they didn’t have two\nhexadecimal characters after them."}]},{type:a,value:d},{type:b,tag:"blog-before-table",props:{},children:[{type:a,value:d}]},{type:a,value:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{type:b,tag:"table",props:{},children:[{type:b,tag:"thead",props:{},children:[{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{},children:[]},{type:b,tag:j,props:{},children:[{type:a,value:"Backend"}]},{type:b,tag:j,props:{},children:[{type:a,value:"Mobile"}]},{type:b,tag:j,props:{},children:[{type:a,value:"Desktop"}]},{type:b,tag:j,props:{},children:[{type:a,value:"Web"}]}]}]},{type:b,tag:"tbody",props:{},children:[{type:b,tag:i,props:{},children:[{type:b,tag:c,props:{},children:[{type:a,value:"Displays the user:pass"}]},{type:b,tag:c,props:{},children:[{type:a,value:"N\u002FA"}]},{type:b,tag:c,props:{},children:[{type:a,value:h}]},{type:b,tag:c,props:{},children:[{type:a,value:h}]},{type:b,tag:c,props:{},children:[{type:a,value:h}]}]},{type:b,tag:i,props:{},children:[{type:b,tag:c,props:{},children:[{type:a,value:"Link contains the user:pass"}]},{type:b,tag:c,props:{},children:[{type:a,value:e}]},{type:b,tag:c,props:{},children:[{type:a,value:h}]},{type:b,tag:c,props:{},children:[{type:a,value:e}]},{type:b,tag:c,props:{},children:[{type:a,value:e}]}]},{type:b,tag:i,props:{},children:[{type:b,tag:c,props:{},children:[{type:a,value:"Accepts percent encoded symbols (%78)"}]},{type:b,tag:c,props:{},children:[{type:a,value:e}]},{type:b,tag:c,props:{},children:[{type:a,value:e}]},{type:b,tag:c,props:{},children:[{type:a,value:e}]},{type:b,tag:c,props:{},children:[{type:a,value:e}]}]},{type:b,tag:i,props:{},children:[{type:b,tag:c,props:{},children:[{type:a,value:"Accepts unicode percent encoding (%u0078)"}]},{type:b,tag:c,props:{},children:[{type:a,value:e}]},{type:b,tag:c,props:{},children:[{type:a,value:e}]},{type:b,tag:c,props:{},children:[{type:a,value:h}]},{type:b,tag:c,props:{},children:[{type:a,value:h}]}]}]}]},{type:a,value:d},{type:b,tag:"blog-caption",props:{},children:[{type:a,value:"\nDifferent handling between the server and each of the clients\n"}]},{type:a,value:"\n\n\n"},{type:b,tag:"blog-after-table",props:{},children:[{type:a,value:d}]},{type:a,value:d},{type:b,tag:f,props:{},children:[{type:a,value:"The desktop and web clients break when they receive invalid percent encoding in the authentication\npart of a URL. This happens because the JavaScript URL parser creates an uncaught error when it\nattempts to "},{type:b,tag:g,props:{},children:[{type:a,value:"decodeURIComponent"}]},{type:a,value:" the authentication prefix."}]},{type:a,value:d},{type:b,tag:f,props:{},children:[{type:a,value:"The message "},{type:b,tag:g,props:{},children:[{type:a,value:q}]},{type:a,value:" can be successfully sent from a mobile app, or by intercepting\nand editing the POST request to the server. The mobile app isn’t affected and displays a link to\n"},{type:b,tag:g,props:{},children:[{type:a,value:"http:\u002F\u002Fexample.com"}]},{type:a,value:". The desktop client will not receive any future messages, and reloading the\ndesktop and web clients will result in a never-ending loading screen — no messages in that channel\ncan ever be viewed again (except on a mobile device)."}]},{type:a,value:d},{type:b,tag:u,props:{src:"discord_1.png"},children:[{type:a,value:"\n  This is what a user will see after reloading the web client\n"}]},{type:a,value:d},{type:b,tag:u,props:{src:"discord_2.png"},children:[{type:a,value:"\n  Desktop client: a never-ending loading screen greets the user\n"}]},{type:a,value:d},{type:b,tag:k,props:{},children:[{type:a,value:d}]},{type:a,value:d},{type:b,tag:f,props:{},children:[{type:a,value:"Discord’s time-to-patch was impressively short, with the patch being made live on the same afternoon\nthat I received a human reply, less than two days after my initial report. The patch was released on\nFeb 13 2020 and no clients are currently vulnerable. Discord security described it as “just a client\nparser bug” so no bounty was awarded."}]},{type:a,value:d},{type:b,tag:k,props:{},children:[{type:a,value:d}]},{type:a,value:d},{type:b,tag:f,props:{},children:[{type:a,value:"Thanks again to "},{type:b,tag:l,props:{href:r,rel:[m,n,o],target:p},children:[{type:a,value:s}]},{type:a,value:" for pushing me on when I would have given up\n:)"}]}]},dir:"\u002Fblog\u002Fdiscord-dos-with-single-message",path:"\u002Fblog\u002Fdiscord-dos-with-single-message\u002Findex",extension:".md",createdAt:"2022-11-03T09:02:21.497Z"}}],fetch:{},mutations:[]}}("text","element","td","\n","Y","p","code","N","tr","th","blog-hr","a","nofollow","noopener","noreferrer","_blank","http:\u002F\u002F%zz@example.com","https:\u002F\u002Ftwitter.com\u002Ffransla","@fransla","@","blog-img")));